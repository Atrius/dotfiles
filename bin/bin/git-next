#!/bin/sh

current=$(git rev-parse --abbrev-ref HEAD)
next=
IFS='
'
for branch in `git branch --format='%(refname:short)'`; do
  upstream=$(git rev-parse --abbrev-ref "$branch@{upstream}" 2> /dev/null)
  if [[ "$upstream" == "$current" ]]; then
    if [[ -n $next ]]; then
      echo "Multiple downstream branches: $next and $branch"
      exit 1
    fi
    next=$branch
  fi
done

if [[ -n $next ]]; then
  git checkout $next
fi
